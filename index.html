<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Geometry Dash – Pro Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===================== GLOBAL ===================== */
* {
    box-sizing: border-box;
    user-select: none;
}

body {
    margin: 0;
    background: radial-gradient(circle at top, #1e1e1e, #000);
    font-family: Arial, Helvetica, sans-serif;
    overflow: hidden;
    color: white;
}

/* ===================== UI ===================== */
.screen {
    position: absolute;
    inset: 0;
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    background: rgba(0,0,0,0.6);
    z-index: 10;
}

.screen.active {
    display: flex;
}

button {
    padding: 12px 30px;
    margin: 10px;
    font-size: 18px;
    border: none;
    border-radius: 6px;
    background: #00ffff;
    color: #000;
    cursor: pointer;
}

button:hover {
    background: #00cccc;
}

label {
    margin-top: 15px;
}

/* ===================== CANVAS ===================== */
canvas {
    display: block;
    margin: auto;
    background: linear-gradient(#1a1a1a, #000);
    border: 3px solid #00ffff;
}
</style>
</head>
<body>

<!-- ===================== MENYER ===================== -->
<div id="menu" class="screen active">
    <h1>Geometry Dash – Pro</h1>
    <button onclick="startGame()">Start</button>
    <button onclick="openSettings()">Settings</button>
</div>

<div id="pause" class="screen">
    <h2>Pause</h2>
    <button onclick="resumeGame()">Fortsett</button>
    <button onclick="openSettings()">Settings</button>
    <button onclick="backToMenu()">Meny</button>
</div>

<div id="settings" class="screen">
    <h2>Settings</h2>

    <label>
        Musikk
        <input type="range" min="0" max="1" step="0.01" value="0.3"
               onchange="music.volume = this.value">
    </label>

    <label>
        Lydeffekter
        <input type="range" min="0" max="1" step="0.01" value="0.7"
               onchange="sfxVolume = this.value">
    </label>

    <button onclick="closeSettings()">Tilbake</button>
</div>

<canvas id="game" width="900" height="300"></canvas>

<script>
/* ===================== CANVAS ===================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ===================== AUDIO ===================== */
let sfxVolume = 0.7;

const jumpSound = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
const crashSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
const music = new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_75e8c8f6d7.mp3");
music.loop = true;
music.volume = 0.3;

/* ===================== GAME STATE ===================== */
let gameRunning = false;
let paused = false;

/* ===================== PLAYER ===================== */
const player = {
    x: 120,
    y: 210,
    size: 30,
    velY: 0,
    gravity: 0.7,
    jumpForce: -13,
    rotation: 0,
    onGround: false,
    coyote: 0,
    buffer: 0
};

const COYOTE_TIME = 8;
const BUFFER_TIME = 8;

/* ===================== WORLD ===================== */
let speed = 4;
let gravityDirection = 1; // 1 = normal, -1 = inverted
let scrollX = 0;

/* ===================== LEVEL DESIGN ===================== */
/*
type:
block      = vanlig blokk
spike      = spike
portalG    = gravity portal
portalS    = speed portal
*/

const level = [
    { x: 600, type: "spike" },
    { x: 750, type: "spike" },
    { x: 900, type: "block", h: 50 },

    { x: 1150, type: "portalG" },
    { x: 1300, type: "spike" },
    { x: 1450, type: "spike" },

    { x: 1700, type: "portalS", speed: 6 },
    { x: 1900, type: "block", h: 70 },
    { x: 2150, type: "spike" },
    { x: 2300, type: "spike" },

    { x: 2600, type: "portalG" },
    { x: 2800, type: "block", h: 60 },
    { x: 3000, type: "spike" }
];

/* ===================== INPUT ===================== */
function jumpRequest() {
    player.buffer = BUFFER_TIME;
}

document.addEventListener("keydown", e => {
    if (e.code === "Space") {
        if (!gameRunning) return;
        if (paused) resumeGame();
        else jumpRequest();
    }
    if (e.code === "Escape") togglePause();
});

canvas.addEventListener("mousedown", jumpRequest);
canvas.addEventListener("touchstart", jumpRequest);

/* ===================== GAME FLOW ===================== */
function startGame() {
    document.getElementById("menu").classList.remove("active");
    resetGame();
    gameRunning = true;
    music.play();
}

function resetGame() {
    scrollX = 0;
    speed = 4;
    gravityDirection = 1;
    player.y = 210;
    player.velY = 0;
}

function togglePause() {
    if (!gameRunning) return;
    paused = !paused;
    document.getElementById("pause").classList.toggle("active", paused);
}

function resumeGame() {
    paused = false;
    document.getElementById("pause").classList.remove("active");
}

function backToMenu() {
    paused = false;
    gameRunning = false;
    music.pause();
    document.getElementById("pause").classList.remove("active");
    document.getElementById("menu").classList.add("active");
}

function openSettings() {
    document.getElementById("settings").classList.add("active");
}

function closeSettings() {
    document.getElementById("settings").classList.remove("active");
}

/* ===================== UPDATE ===================== */
function updatePlayer() {
    player.velY += player.gravity * gravityDirection;
    player.y += player.velY;
    player.rotation += 0.15 * gravityDirection;

    const groundY = gravityDirection === 1 ? 210 : 30;

    if ((gravityDirection === 1 && player.y >= groundY) ||
        (gravityDirection === -1 && player.y <= groundY)) {

        player.y = groundY;
        player.velY = 0;
        player.onGround = true;
        player.coyote = COYOTE_TIME;
        player.rotation = 0;
    } else {
        player.onGround = false;
        player.coyote--;
    }

    if (player.buffer > 0 && player.coyote > 0) {
        player.velY = player.jumpForce * gravityDirection;
        player.buffer = 0;
        player.coyote = 0;
        jumpSound.volume = sfxVolume;
        jumpSound.play();
    }

    player.buffer--;
}

function updateLevel() {
    scrollX += speed;
}

function checkCollision() {
    for (let o of level) {
        let x = o.x - scrollX;

        if (o.type === "block") {
            let y = gravityDirection === 1 ? 260 - o.h : 0;
            if (
                player.x < x + 40 &&
                player.x + player.size > x &&
                player.y < y + o.h &&
                player.y + player.size > y
            ) endGame();
        }

        if (o.type === "spike") {
            if (
                player.x + player.size > x &&
                player.x < x + 30 &&
                player.y + player.size > 230 &&
                gravityDirection === 1
            ) endGame();
        }

        if (o.type === "portalG" && Math.abs(x - player.x) < 20) {
            gravityDirection *= -1;
        }

        if (o.type === "portalS" && Math.abs(x - player.x) < 20) {
            speed = o.speed;
        }
    }
}

function endGame() {
    crashSound.volume = sfxVolume;
    crashSound.play();
    backToMenu();
}

/* ===================== DRAW ===================== */
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Ground
    ctx.fillStyle = "#00ffff";
    ctx.fillRect(0,260,canvas.width,4);
    ctx.fillRect(0,0,canvas.width,4);

    // Player
    ctx.save();
    ctx.translate(player.x + 15, player.y + 15);
    ctx.rotate(player.rotation);
    ctx.fillStyle = "#ff00ff";
    ctx.fillRect(-15,-15,30,30);
    ctx.restore();

    // Level
    for (let o of level) {
        let x = o.x - scrollX;

        if (o.type === "block") {
            ctx.fillStyle = "#ff0000";
            ctx.fillRect(x, 260 - o.h, 40, o.h);
        }

        if (o.type === "spike") {
            ctx.fillStyle = "#ffff00";
            ctx.beginPath();
            ctx.moveTo(x,260);
            ctx.lineTo(x+15,230);
            ctx.lineTo(x+30,260);
            ctx.fill();
        }

        if (o.type === "portalG") {
            ctx.strokeStyle = "#00ff00";
            ctx.strokeRect(x,180,30,60);
        }

        if (o.type === "portalS") {
            ctx.strokeStyle = "#ff00ff";
            ctx.strokeRect(x,180,30,60);
        }
    }
}

/* ===================== LOOP ===================== */
function loop() {
    if (gameRunning && !paused) {
        updatePlayer();
        updateLevel();
        checkCollision();
        draw();
    }
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
